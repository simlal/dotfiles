# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'catppuccin/tmux#v2.1.3' # See https://github.com/catppuccin/tmux/tags for additional tags
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-online-status'


######### PREFIX #########
# Set prefix to Ctrl+Space 
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

######### GENERAL SETTINGS #########
# Enable mouse support
set -g mouse on

# Default to zsh
set -g default-shell /usr/bin/zsh

# Set default terminal
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Start windows and panes at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when a window is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Enable activity alerts
set -g monitor-activity on
# set -g visual-activity on

# Faster command sequences
set -s escape-time 10

# Refresh status line every 60 seconds
set -g status-interval 60

# Enable focus events
set -g focus-events on

######### General statusline customisation #########
# set -ogq @thm_flamingo "#eebebe"
# set -ogq @thm_rosewater "#f2d5cf"
# set -ogq @thm_pink "#f4b8e4"
# set -ogq @thm_mauve "#ca9ee6"
# set -ogq @thm_red "#e78284"
# set -ogq @thm_maroon "#ea999c"
# set -ogq @thm_peach "#ef9f76"
# set -ogq @thm_yellow "#e5c890"
# set -ogq @thm_green "#a6d189"
# set -ogq @thm_teal "#81c8be"
# set -ogq @thm_sky "#99d1db"
# set -ogq @thm_sapphire "#85c1dc"
# set -ogq @thm_blue "#8caaee"
# set -ogq @thm_lavender "#babbf1"

# THEME FLAVOR
set -g @catppuccin_flavor 'frappe'

### Status bar ###
set -g status-style 'bg=terminal'
set -g status-position top
set -g status-justify "absolute-centre"

# status left style
set -g status-left-length 100
set -g status-left ""
set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_red},fg=default,bold] ÓØà  #S },#{#[bg=default,fg=#{@thm_red},bold] ÓØà  #S }}"
set -ga status-left "#[bg=default,fg=#{@thm_overlay0},none,bold]‚îÇ"
set -ga status-left "#[bg=default,fg=#{@thm_green},bold] Ó™Ö  #{pane_current_command} "
set -ga status-left "#[bg=default,fg=#{@thm_overlay0},none,bold]‚îÇ"
set -ga status-left "#[bg=default,fg=#{@thm_blue},bold] Ó´∑  #{=/-10/...:#{s|$USER|~|:#{b:pane_current_path}}} "
set -ga status-left "#[bg=default,fg=#{@thm_overlay0},none,bold]#{?window_zoomed_flag,‚îÇ,}"
set -ga status-left "#[bg=default,fg=#{@thm_yellow},bold]#{?window_zoomed_flag, Ó≠ø  zoom ,}"

# status right style
set -g status-right-length 100
set -g status-right ""
set -ga status-right "#{?#{e|>=:10,#{battery_percentage}},#{#[bg=#{@thm_red},fg=#{@thm_mantle}]},#{#[bg=#{@thm_mantle},fg=#{@thm_pink}]}} #{battery_icon} #{battery_percentage} "
set -ga status-right "#[bg=#{@thm_mantle},fg=#{@thm_overlay_0}, none]‚îÇ"
set -ga status-right "#[bg=#{@thm_mantle}]#{?#{==:#{online_status},ok},#[fg=#{@thm_mauve}] Û∞ñ© on ,#[fg=#{@thm_red},bold]#[reverse] Û∞ñ™ off }"
set -ga status-right "#[bg=#{@thm_mantle},fg=#{@thm_overlay_0}, none]‚îÇ"
set -ga status-right "#[bg=#{@thm_mantle},fg=#{@thm_blue}] Û∞≠¶ %Y-%m-%d Û∞Öê %H:%M "

# window style
set -wg automatic-rename on
set -g automatic-rename-format ''
set -g window-status-separator '|'
set -g status-justify 'absolute-centre'
set -g @catppuccin_window_status_style 'custom'
set -g @catppuccin_window_flags ""
set -g @catppuccin_window_number ""
set -g @catppuccin_window_current_number ""
set -g @catppuccin_window_text "#[fg=#{@thm_rosewater},bg=#{@thm_mantle}] #I#{?#{!=:#{window_name},},: #W ,}#{?window_bell_flag,#[fg=#{@thm_red}] Û∞Çû#[fg=#{@thm_rosewater}],}#{?window_activity_flag,#[fg=#{@thm_red}] Û∞Çû#[fg=#{@thm_rosewater}],}"
set -g @catppuccin_window_current_text "#[fg=#{@thm_mantle},bg=#{@thm_peach}] #I#{?#{!=:#{window_name},},: #W ,}#{?window_bell_flag,#[fg=#{@thm_red}] Û∞Çû#[fg=#{@thm_mantle}],}#{?window_activity_flag,#[fg=#{@thm_red}] Û∞Çû#[fg=#{@thm_mantle}],}"

### Pane borders
set -g @catppuccin_pane_active_border_style "fg=#{@thm_teal},bold"
set -g @catppuccin_pane_border_style "fg=#{@thm_overlay_0}"
set -g pane-border-lines heavy
#
# ### Pane dimming
set -g window-active-style 'fg=terminal,bg=terminal'
set -g window-style 'fg=#{@thm_overlay_0},bg=#{@thm_mantle}'

### Focus hooks for window-level dimming
set-hook -g client-focus-in "set window-active-style 'fg=terminal,bg=terminal'"
set-hook -g client-focus-out "set window-active-style 'fg=#{@thm_overlay_0},bg=#{@thm_mantle}'"

# Configure Online
set -g @online_icon "ok"
set -g @offline_icon "nok"


######### KEYBINDINGS #########

# Reload config
bind , source-file ~/.tmux.conf \; display "Config reloaded!"

# New tab/windows 
bind t new-window
bind n new-window

# Tab navigation 
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5
bind 6 select-window -t 6
bind 7 select-window -t 7
bind 8 select-window -t 8
bind 9 select-window -t 9
bind '[' previous-window
bind ']' next-window

# Close tab/window
bind w kill-window

# Move tabs (windows)
bind < swap-window -d -t -1
bind > swap-window -d -t +1

# Rename window
bind-key r command-prompt -I "#W" "rename-window '%%'"

# Splits / panes
bind x kill-pane
bind '\' split-window -h -c "#{pane_current_path}"  # vertical split (right)
bind - split-window -v -c "#{pane_current_path}"    # horizontal split (down)
bind z resize-pane -Z  # toggle zoom
bind -n C-M-p display-panes

# Split navigation 
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Split resizing 
bind -n C-M-h resize-pane -L 3
bind -n C-M-l resize-pane -R 3
bind -n C-M-k resize-pane -U 3
bind -n C-M-j resize-pane -D 3
bind = select-layout even-horizontal  # equalize splits

# Session management with sesh
bind-key \/ run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt '‚ö°  ' \
    --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}'
)\""

# Copy mode settings
setw -g mode-keys vi
bind v copy-mode -e
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Open scrollback in editor 
set-environment -g EDITOR "nvim"
set-environment -g VISUAL "nvim"
bind s capture-pane -S - -E - \; \
    save-buffer /tmp/tmux-capture.txt \; \
    new-window "sh -c '\$EDITOR /tmp/tmux-capture.txt'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
